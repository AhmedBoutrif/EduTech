{# templates/reservation/edit.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Modifier la Réservation{% endblock %}

{% block main %}
   
    <div class="container mt-5">
        <h1 class="mb-4">Modifier la réservation</h1>
        
        {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
        
        <div class="mb-3">
            {{ form_label(form.topic, 'Sujet ', {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.topic, {
                'attr': {
                    'class': 'form-control',
                    'id': 'topicInput',
                    'maxlength': '255',
                    'oninput': 'updateCharCount()'
                }
            }) }}   
      
            <p id="charCount" class="text-muted">0 / 255</p>
            
            {% if form.topic.vars.errors|length > 0 %}
                <p class="text-danger">{{ form_errors(form.topic) }}</p>
            {% endif %}
            {{ form_errors(form.topic) }}
        </div>

       <div class="mb-3">
    <label for="reservation_date" class="form-label">Date</label>
    <input type="text" id="reservation_date" class="form-control" 
           value="{{ reservation.avaibility.date|date('Y-m-d') }}" disabled>
</div>


        <div class="mb-3">
            {{ form_label(form.hour) }}
            {{ form_widget(form.hour, { 'attr': {'class': 'form-control'} }) }}
            {{ form_errors(form.hour) }}
        </div>

        <div class="mb-3">
            {{ form_label(form.duration, "Durée (minutes)", {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.duration, {
                'attr': {
                    'class': 'form-control',
                    'id': 'durationInput'
                }
            }) }}
            {{ form_errors(form.duration) }}
        </div>

        <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
        <a href="{{ path('app_reservation_index') }}" class="btn btn-secondary">Retour</a>
        {{ form_end(form) }}
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const timePicker = document.querySelector('.time-picker');
            if (timePicker) {
                flatpickr(timePicker, {
                    enableTime: true,
                    noCalendar: true,
                    dateFormat: "H:i",
                    time_24hr: true,
                    minuteIncrement: 15
                     defaultDate: "{{ reservation.startTime|date('H:i') }}" 
                      defaultHour: {{ reservation.startTime|date('G') }}, 
                    defaultMinute: {{ reservation.startTime|date('i') }}
                });
            }
        });

        function updateCharCount() {
            var inputField = document.getElementById("topicInput");
            var charCount = inputField.value.length;
            var maxLength = inputField.getAttribute("maxlength");
            var charCountElement = document.getElementById("charCount");

            charCountElement.innerText = charCount + " / " + maxLength;

            if (charCount < 20) {
                charCountElement.style.color = "red";
            } else {
                charCountElement.style.color = "green";
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            let hourInput = document.getElementById("reservation_hour");
            hourInput.setAttribute("min", "{{ form.hour.vars.attr.min }}");
            hourInput.setAttribute("max", "{{ form.hour.vars.attr.max }}");
        });

        document.addEventListener("DOMContentLoaded", function() {
            updateCharCount();
            document.getElementById("topicInput").addEventListener("input", updateCharCount);
        });
    </script>
{% endblock %}
