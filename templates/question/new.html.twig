{# templates/question/new.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Créer une nouvelle question{% endblock %}

{% block main %}
<div class="container">
    <h1 class="my-4">Créer une nouvelle question</h1>

    {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

    <!-- Champ pour la question -->
    <div class="form-group">
        <label class="control-label">Question :</label>
        {{ form_widget(form.question, {'attr': {'class': 'form-control'}}) }}
    </div>

    <!-- Champ pour la réponse correcte -->
    <div class="form-group">
        <label class="control-label">Réponse correcte :</label>
        {{ form_widget(form.reponseCorrecte, {'attr': {'class': 'form-control'}}) }}
    </div>

    <!-- Section pour les options -->
    <div id="options-container" class="my-4">
        <h3>Options</h3>
        <ul class="options list-unstyled" data-prototype="{{ form_widget(form.options.vars.prototype)|e('html_attr') }}">
            {% for option in form.options %}
                <li class="option-block card mb-3">
                    <div class="card-body">
                        {{ form_row(option, {'attr': {'class': 'form-control'}}) }}
                        <button type="button" class="btn btn-danger remove-option">Supprimer</button>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <button type="button" id="add-option" class="btn btn-primary">Ajouter une option</button>
    </div>

    <!-- Bouton Enregistrer -->
    <div class="text-center mt-4">
        <button type="submit" class="btn btn-success">Enregistrer</button>
    </div>

    {{ form_end(form) }}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const optionsContainer = document.querySelector('ul.options');
        const addButton = document.getElementById('add-option');
        const prototype = optionsContainer.dataset.prototype;

        addButton.addEventListener('click', function() {
            const index = optionsContainer.children.length;
            let newOption = prototype.replace(/__name__/g, index);
            
            const newElement = document.createElement('li');
            newElement.classList.add('option-block', 'card', 'mb-3');
            newElement.innerHTML = `
                <div class="card-body">
                    ${newOption}
                    <button type="button" class="btn btn-danger remove-option">Supprimer</button>
                </div>
            `;
            optionsContainer.appendChild(newElement);
        });

        optionsContainer.addEventListener('click', function(event) {
            if (event.target.classList.contains('remove-option')) {
                event.target.closest('.option-block').remove();
            }
        });
    });
</script>
{% endblock %}